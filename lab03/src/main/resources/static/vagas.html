<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vagas</title>
</head>
<body>	
        <h1>Gerenciamento de Vagas</h1>

        <table>    
            <tr> <td>ID:</td> <td><input type="text" id="txtId"></td> </tr>
            <tr> <td>Título:</td> <td><input type="text" id="txtTitulo"></td> </tr>
			<tr> <td>Descrição:</td> <td><input type="text" id="txtDescricao"></td> </tr>
			<tr> <td>Data Publicação:</td> <td></td><input type="date" id="txtDataPublicacao"></td></tr>
			<tr> <td>Ativo: </td> <td></td><input type="text" id="txtAtivo"></td></tr>
            <tr><td></td><td>
                <input type="button" value="Novo" onclick="novaVaga()" id="btnNovo">
                <input type="button" value="Salvar" onclick="salvarVaga()" id="btnSalvar">
                <input type="button" value="Apagar" onclick="apagarVaga()" id="btnApagar">
                <input type="button" value="Cancelar" onclick="cancelarEdicao()" id="btnCancelar">
            </td></tr>
        </table> 
        
		<p style="font-weight:bold" id="paragrafoMensagem"></p>
		
        <table id="tabelaVagas">    
            <tr> <th>ID</th> <th>Titulo</th> <th>Descrição</th> <th>Data Publicação</th> <th>Ativo</th> </tr>
            <tbody id="corpoTabelaVagas"> </tbody>
        </table>

        <script>
			const tabelaVagas = document.querySelector('#tabelaVagas');
	        const corpoTabela = document.querySelector('#corpoTabelaVagas');
	        const paragrafoMensagem = document.querySelector('#paragrafoMensagem');
	        const txtId = document.querySelector('#txtId');
	        const txtTitulo = document.querySelector('#txtTitulo');
			const txtDescricao = document.querySelector('#txtDescricao');
			const txtDataPublicacao = document.querySelector('#txtDataPublicacao');
			const txtAtivo = document.querySelector('#txtAtivo');
	        
	        const btnNovo = document.querySelector('#btnNovo');
	        const btnSalvar = document.querySelector('#btnSalvar');
	        const btnApagar = document.querySelector('#btnApagar');
	        const btnCancelar = document.querySelector('#btnCancelar');
	        var criandoNovaVaga = false;
	        
	        inicializar();

	        function inicializar() {
	        	criandoNovaVaga = false;
	            paragrafoMensagem.innerHTML = 'Pressione o botão Novo ou selecione uma vaga da lista:'
	            txtId.value = '';
	            txtTitulo.value = '';
				txtDescricao.value = '';
				txtDataPublicacao.value = '';
				txtAtivo.value = '';

	            txtId.disabled = true;
	            txtTitulo.disabled = true;
				txtDescricao.disabled = true;
				txtDataPublicacao.disabled = true;
				txtAtivo.disabled = true;

	            btnNovo.disabled = false;
	            btnSalvar.disabled = true;
	            btnApagar.disabled = true;
	            btnCancelar.disabled = true;
	            listarTodasVagas();            
	        }

	        async function listarTodasVagas() {
	            const URL = `/mackenzie/vagas`;
	            fetch(URL)
	              .then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta;}) 
	              .then(resposta => resposta.json())
	              .then(jsonResponse => preencherTabela(jsonResponse))
	              .catch(function(error) { paragrafoMensagem.innerHTML = "Erro ao listar vagas (código " + error.message + ")";});
	        }
	        
	        
	        function preencherTabela(vagas) {
	            var linhasTabela = '';
	            for (var i = 0; i < vagas.length; i++) {
	                var f = vagas[i];
	                linhasTabela += 
					`<tr>
						<td><a href="javascript:void(0)" onclick="selecionarVaga('${f.id}','${f.titulo}','${f.descricao}','${f.dataPublicacao},'${f.ativo}'')">${f.id}</a></td>
						<td>${f.titulo}</td>
					</tr>`;
	            }
	            corpoTabela.innerHTML = linhasTabela;
	        }

	        function selecionarVaga(id, titulo, descricao, dataPublicacao, ativo) {
	        	criandoNovaVaga = false;
	            paragrafoMensagem.innerHTML = 'Altere e salve os dados da vaga, ou então apague o registro da Vaga.'
	            txtId.value = id;
	            txtTitulo.value = titulo;
				txtDescricao.value = descricao;
				txtDataPublicacao.value = dataPublicacao;
				txtAtivo.value = ativo;

	            txtId.disabled = true;
	            txtTitulo.disabled = false;
				txtDescricao.disabled = false;
				txtDataPublicacao.disabled = false;
				txtAtivo.disabled = false;

	            btnNovo.disabled = true;
	            btnSalvar.disabled = false;
	            btnApagar.disabled = false;
	            btnCancelar.disabled = false;
	        }

	        function novaVaga() {
	        	paragrafoMensagem.innerHTML = 'Preencha os dados da nova vaga...';
	        	criandoNovaVaga = true;
	        	
	        	txtId.value = '';
	        	txtTitulo.value = '';
				txtDescricao.value = '';
				txtDataPublicacao.value = '';
				txtAtivo.value = '';
	        	
	        	txtId.disabled = true;
	        	txtTitulo.disabled = false;
				txtDescricao.disabled = false;
				txtDataPublicacao.disabled = false;
				txtAtivo.disabled = false;
	        	
	        	btnNovo.disabled = true;
	        	btnSalvar.disabled = false;
	        	btnApagar.disabled = true;
	        	btnCancelar.disabled = false;
	        }
	        
	        function salvarVaga() {
	        	if (criandoNovaVaga) {
	        		criarVaga();
	        	}
	        	else {
	        		alterarVaga();
	        	}
	        }
	        
	        async function criarVaga() {
	        	const URL = `/mackenzie/vagas`;
	        	const dadosVagas = {
	        		'titulo': txtTitulo.value,
					'descricao': txtDescricao.value,
					'dataPublicacao': txtDataPublicacao.value,
					'ativo': txtAtivo.value
	        	};
	        	const postRequest = {
	        		method: 'POST',
	        		body: JSON.stringify(dadosVagas),
	        		headers: { 'Content-type': 'application/json' }
	        	};
	        	fetch(URL, postRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => resposta.json())
	        		.then(jsonResponse => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao criar nova vaga (código ' + error.message + ')'; } );
	        }
	        
	        async function alterarVaga() {
	        	const ID = txtId.value;
	        	const URL = `/mackenzie/vagas/${ID}`;
	        	const dadosVaga = {
	        		'id': ID,
	        		'titulo': txtTitulo.value,
					'descricao': txtDescricao.value,
					'dataPublicacao': txtDataPublicacao.value,
					'ativo': txtAtivo.value
	        	};
	        	const putRequest = {
	        		method: 'PUT',
	        		body: JSON.stringify(dadosVaga),
	        		headers: { 'Content-type': 'application/json' }
	        	};
	        	fetch(URL, putRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => resposta.json())
	        		.then(jsonResponse => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao alterar vaga (código ' + error.message + ')'; } );	        	
	        }
	        
	        function cancelarEdicao() {
	        	inicializar();
	        }
	        
	        async function apagarVaga() {
	        	const ID = txtId.value;
	        	const URL = `/mackenzie/vagas/${ID}`;
	        	const deleteRequest = {
	        		method: 'DELETE'
	        	};
	        	fetch(URL, deleteRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao apagar vaga (código ' + error.message + ')'; } );	        		
	        }
	        
	    </script>   

		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
				height: 100vh;
				box-sizing: border-box;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			th, tr, td {
				padding: 8px;
				text-align: left;    
			}
		</style>
</body>
</html>